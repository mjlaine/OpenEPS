#!/bin/bash
#
# EXPERIMENT SPECIFIC SETTINGS
#
# test - EPS1
#
# Example settings for an ensemble run with initial state linking
# from a local repository. Same initial state used for all ens
# members, ens spread generated through enabling SPPT model error
# repsentation. 
#

# --------------------------------------------------------------
# GENERAL
# --------------------------------------------------------------
# Basics
EXPL="EPS_par"  # Long exp name
EXPS="teps"       # 4 letter exp name
SDATE=2013110212  # Exp start date
EDATE=2013110212  # Exp end   date
DSTEP=24          # Hours between ensembles
export EXPL EXPS SDATE EDATE DSTEP

# Resolution, vertical levels, model run length (in steps[/hours/days])
RES=21
LEV=19
FCLEN=12

# Ensemble size (CTRL is always member 0, so real size is ENS+1)
ENS=3

# Resources
# (number of nodes, number of cores per model,
# estimate of model execution time)
NNODES=1
CPUSPERMODEL=2
TIMEFORMODEL=0.5
export RES LEV FCLEN ENS NNODES

# Version
OIFSv=40r1v1

# Model bin
MODEL_EXE=$HOME/projects/OIFS/oifs${OIFSv}/make/gnu-opt/oifs/bin/master.exe

# EPPES bin
EPPES_EXE=/home/ollin/playground/eppes/eppes_routine

# --------------------------------------------------------------
# REQUIRED DIRS AND SCRIPTS
# --------------------------------------------------------------
# Model structure and programs that are needed
REQUIRE_DIRS="WORK SCRI DATA SRC BIN"
REQUIRE_ITEMS="main.bash link.bash run.bash mandtg util_tools.bash define_makefile ppro.bash ppro_ens.bash par_init.bash par_gen.bash par_set.bash"
REQUIRE_NAMEL="namelist_general.bash namelist_${OIFSv}_t$RES.bash"



# --------------------------------------------------------------
# TESTING
# --------------------------------------------------------------
# Vital executables that must exist
REQUIRE_PATHS="$REQUIRE_PATHS MODEL_EXE EPPES_EXE cdo mpirun"

# Vital variables that must exist
REQUIRE_VARS="$REQUIRE_VARS EXPL EXPS SDATE EDATE DSTEP RES LEV FCLEN ENS NNODES"



# --------------------------------------------------------------
# MODEL RUN OPTIONS
# --------------------------------------------------------------

# Stochastic physics
LSPPT="true"
LSKEB="false" # "true" does not work with cy38r1

# Parameter estimation
LPAR="true"


# --------------------------------------------------------------
# MODEL OUTPUT
# --------------------------------------------------------------

# Output frequency (6=1h, 36=6h, 72=12h)
NFRPOS=12
NFRHIS=12
NPOSTS=0
NHISTS=0

# Model level variables and model levels
VARSM="130 138 155 133"   # String list with spaces in between
LEVSM=$(echo $(seq 19)) # String list with spaces in between
LEVSM="-99"

# Pressure level variables and pressure levels (in Pa)
VARSP="129 130"
LEVSP="50000.0 92500.0"

# Surface level dynamic variables
VARSS="129 152"

# Surface variables
VARPP="151 165 176 177 208"



# --------------------------------------------------------------
# POST-PROCESSING
# --------------------------------------------------------------

# pp freqency, space separated list of model times steps
NPPRO=""
ttime=$NFRPOS
while [ $ttime -le $FCLEN ]; do
    NPPRO="$NPPRO $(printf "%04d" $ttime)"
    ttime=$(( ttime + NFRPOS ))
done
# 
